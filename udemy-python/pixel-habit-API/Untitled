"""
Pixela Habit Tracker Practice Scaffold

Goal (for the challenge):
- Comment out graph creation code (once the graph exists)
- POST a pixel for a specific date
- Refresh Pixela and see the new pixel

Docs:
- https://docs.pixe.la/
"""

import os
import requests
from datetime import datetime

# ----------------------------
# 1) Configuration
# ----------------------------
PIXELA_BASE_URL = "https://pixe.la/v1/users"

# Prefer environment variables so you don't hardcode secrets.
# In your terminal (macOS/Linux), run:
#   export PIXELA_USERNAME="your_username"
#   export PIXELA_TOKEN="your_token"
#
# Or temporarily set them inside your IDE's run configuration.
USERNAME = os.getenv("PIXELA_USERNAME", "YOUR_USERNAME_HERE")
TOKEN = os.getenv("PIXELA_TOKEN", "YOUR_TOKEN_HERE")

# Your graph settings (edit these)
GRAPH_ID = "coding1"              # must be lowercase letters/numbers only
GRAPH_NAME = "Coding Practice"
UNIT = "min"                      # e.g. "min", "pages", "km"
TYPE = "int"                      # "int" or "float"
COLOR = "ajisai"                  # e.g. shibafu, momiji, sora, ichou, ajisai, kuro

HEADERS = {
    "X-USER-TOKEN": TOKEN
}

# ----------------------------
# 2) Helper functions
# ----------------------------
def create_user():
    """Create a Pixela user (run once)."""
    endpoint = PIXELA_BASE_URL
    payload = {
        "token": TOKEN,
        "username": USERNAME,
        "agreeTermsOfService": "yes",
        "notMinor": "yes",
    }
    r = requests.post(url=endpoint, json=payload)
    print("create_user:", r.status_code, r.text)


def create_graph():
    """Create a graph (run once per graph)."""
    endpoint = f"{PIXELA_BASE_URL}/{USERNAME}/graphs"
    payload = {
        "id": GRAPH_ID,
        "name": GRAPH_NAME,
        "unit": UNIT,
        "type": TYPE,
        "color": COLOR,
    }
    r = requests.post(url=endpoint, json=payload, headers=HEADERS)
    print("create_graph:", r.status_code, r.text)


def post_pixel(date_yyyymmdd: str, quantity: str):
    """
    Add a pixel for a given date.
    date_yyyymmdd example: "20260106"
    quantity must be a string per Pixela docs, even for numbers.
    """
    endpoint = f"{PIXELA_BASE_URL}/{USERNAME}/graphs/{GRAPH_ID}"
    payload = {
        "date": date_yyyymmdd,
        "quantity": quantity,
    }
    r = requests.post(url=endpoint, json=payload, headers=HEADERS)
    print("post_pixel:", r.status_code, r.text)


def update_pixel(date_yyyymmdd: str, quantity: str):
    """Update an existing pixel (PUT)."""
    endpoint = f"{PIXELA_BASE_URL}/{USERNAME}/graphs/{GRAPH_ID}/{date_yyyymmdd}"
    payload = {"quantity": quantity}
    r = requests.put(url=endpoint, json=payload, headers=HEADERS)
    print("update_pixel:", r.status_code, r.text)


def delete_pixel(date_yyyymmdd: str):
    """Delete a pixel (DELETE)."""
    endpoint = f"{PIXELA_BASE_URL}/{USERNAME}/graphs/{GRAPH_ID}/{date_yyyymmdd}"
    r = requests.delete(url=endpoint, headers=HEADERS)
    print("delete_pixel:", r.status_code, r.text)


def graph_url() -> str:
    """Convenience: open this in your browser to see your graph."""
    return f"https://pixe.la/v1/users/{USERNAME}/graphs/{GRAPH_ID}.html"


# ----------------------------
# 3) Practice driver
# ----------------------------
def main():
    # Quick sanity checks:
    if USERNAME.startswith("YOUR_") or TOKEN.startswith("YOUR_"):
        print("Set PIXELA_USERNAME and PIXELA_TOKEN (or replace placeholders in code).")
        return

    print("Your graph URL:")
    print(graph_url())
    print()

    # ---- Run these ONCE, then comment them out ----
    # create_user()
    # create_graph()

    # ---- Challenge focus: POST a pixel for a specific date ----
    # Option A: hardcode a date (recommended for the challenge)
    date_str = "20260106"      # YYYYMMDD
    qty = "30"                 # must be a string; int graph expects whole numbers
    post_pixel(date_str, qty)

    # Option B: post for "today" using datetime (useful later)
    # today = datetime.now().strftime("%Y%m%d")
    # post_pixel(today, "1")

    # Extra practice:
    # update_pixel(date_str, "45")
    # delete_pixel(date_str)


if __name__ == "__main__":
    main()
